<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- CRITICAL: Viewport meta tag is essential for mobile responsiveness -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Train 20496 Passenger Manifest Analysis</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Chart.js for visualizations -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <style>
        /* Custom Tailwind Configuration for Deep Blue Theme */
        :root {
            --color-primary: #1e3a8a; /* Deep Blue */
            --color-secondary: #3b82f6; /* Bright Blue */
            --color-dark: #0f172a; /* Slate 900 */
        }
        .deep-blue-bg { background-color: var(--color-dark); }
        .primary-text { color: var(--color-secondary); }
        .primary-card-bg { background-color: #1e293b; } /* Slate 800 */
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--color-dark);
        }
        
        .chart-container {
            position: relative;
            /* Reduced height for mobile screens */
            height: 250px; 
            width: 100%;
        }

        /* Consistent chart height for medium screens and up */
        @media (min-width: 768px) {
            .chart-container {
                height: 300px;
            }
        }

        /* --- STYLING FOR SMALLER SEAT MAPS --- */
        #seat-map-view-container {
            overflow-x: auto;
            max-width: 100%;
            /* Constrain height to make the overall map section smaller */
            max-height: 450px; 
        }
        .coach-map-container {
            padding: 12px; /* Reduced padding */
            margin-bottom: 20px;
        }
        .seat-bay-row {
            display: grid;
            /* 3 Main Seats | Passage (0.5fr) | 2 Side Seats */
            grid-template-columns: repeat(3, minmax(0, 1fr)) 0.5fr repeat(2, minmax(0, 1fr));
            gap: 2px; /* Reduced gap */
            padding: 4px 0; /* Reduced padding */
            border-bottom: 1px dashed rgba(59, 130, 246, 0.3);
        }
        .seat-bay-row:last-child {
            border-bottom: none;
        }
        .seat-bay-label {
            grid-column: 1 / 7;
            text-align: center;
            font-size: 0.65rem; /* Smaller label */
            color: #94a3b8;
            margin-bottom: 2px;
        }
        .seat-element {
            padding: 4px 2px; /* Reduced padding */
            text-align: center;
            font-weight: 600;
            border-radius: 4px; /* Slightly smaller radius */
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2); /* Smaller shadow */
            transition: all 0.15s ease-in-out;
            cursor: pointer;
            color: #0f172a; 
            font-size: 0.7rem; /* Smaller font size */
            line-height: 1.1;
        }
        .seat-element:hover {
            transform: scale(1.03);
            box-shadow: 0 3px 6px rgba(59, 130, 246, 0.4);
        }
        /* Seat Colors */
        .seat-occupied { background-color: #10b981; } /* Emerald Green */
        .seat-available { background-color: #4b5563; } /* Gray 600 */

        /* Specific seat positioning for 3AC (These are defined in JS but kept here as reference) */
        .seat-lb { grid-column: 1; }
        .seat-mb { grid-column: 2; }
        .seat-ub { grid-column: 3; }
        .seat-sl { grid-column: 5; } /* Skip column 4 for passage */
        .seat-su { grid-column: 6; }
    </style>
</head>
<body class="deep-blue-bg text-gray-100 min-h-screen">
    <div class="text-center text-gray-400 mt-4 mb-6 text-sm tracking-wide">
        <div class="text-center text-gray-400 mt-4 mb-1 text-sm tracking-wide">
    Visualization Created and Executed by
        </div>

        <div class="text-center text-blue-400 text-lg font-semibold mb-6">
    Darsh Rajendra Jain
        </div>
        
    

    <div class="container mx-auto p-4 md:p-8">
        <!-- Header Section (Adjusted text size for mobile) -->
        <header class="text-center mb-10 py-6 bg-slate-800 rounded-xl shadow-2xl">
            <h1 class="text-3xl sm:text-4xl md:text-5xl font-extrabold tracking-tight primary-text">
                Train 20496 Passenger Analytics
            </h1>
            <p class="text-xl text-gray-400 mt-2">
                KALYAN to FALNA-Kumar Weds Riddhi-26th Nov 2025
            </p>
        </header>

        <!-- Data Container & Analysis Section -->
        <!-- Row 1: Key Metrics & Demographic Charts (Single column on mobile, 3 on large screens) -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-10">

            <!-- Card 1: Key Metrics -->
            <div class="lg:col-span-1 primary-card-bg p-6 rounded-xl shadow-xl border border-blue-800">
                <h2 class="text-2xl font-bold primary-text mb-4 border-b border-blue-700 pb-2">Key Insights</h2>
                <div class="space-y-4">
                    <div class="flex justify-between items-center bg-slate-700 p-3 rounded-lg">
                        <span class="text-gray-300 font-medium">Total Passengers:</span>
                        <span id="total-passengers" class="text-3xl font-extrabold primary-text">45</span>
                    </div>
                    <div class="flex justify-between items-center bg-slate-700 p-3 rounded-lg">
                        <span class="text-gray-300 font-medium">Total Males:</span>
                        <span id="total-males" class="text-3xl font-extrabold text-blue-500">19</span>
                    </div>
                    <div class="flex justify-between items-center bg-slate-700 p-3 rounded-lg">
                        <span class="text-gray-300 font-medium">Total Females:</span>
                        <span id="total-females" class="text-3xl font-extrabold text-pink-400">26</span>
                    </div>
                </div>
            </div>

            <!-- Card 2: Gender Distribution Chart -->
            <div class="lg:col-span-1 primary-card-bg p-6 rounded-xl shadow-xl border border-blue-800">
                <h2 class="text-2xl font-bold primary-text mb-4 border-b border-blue-700 pb-2">Gender Breakdown</h2>
                <div class="chart-container flex items-center justify-center">
                    <canvas id="genderDistributionChart"></canvas>
                </div>
            </div>

            <!-- Card 3: Age Distribution Chart -->
            <div class="lg:col-span-1 primary-card-bg p-6 rounded-xl shadow-xl border border-blue-800">
                <h2 class="text-2xl font-bold primary-text mb-4 border-b border-blue-700 pb-2">Age Distribution</h2>
                <div class="chart-container">
                    <canvas id="ageDistributionChart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Row 2: Utilization Analysis (Charts) -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-10"> 
            <!-- Component 1: Coach Utilization Chart -->
            <div class="primary-card-bg p-6 rounded-xl shadow-xl border border-blue-800">
                <h2 class="text-2xl font-bold primary-text mb-4 border-b border-blue-700 pb-2">Coach Utilization (Seats Occupied)</h2>
                <div class="chart-container">
                     <canvas id="coachUtilizationChart"></canvas>
                </div>
            </div>
            <!-- Component 2: Seat Type Tally Chart -->
            <div class="primary-card-bg p-6 rounded-xl shadow-xl border border-blue-800">
                <h2 class="text-2xl font-bold primary-text mb-4 border-b border-blue-700 pb-2">Seat Type Tally (Count)</h2>
                <div class="chart-container">
                     <canvas id="seatTypeTallyChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Row 3: Seat Map View -->
        <div class="lg:col-span-3 primary-card-bg p-6 rounded-xl shadow-2xl border border-blue-800">
            <h2 class="text-2xl font-bold primary-text mb-4 border-b border-blue-700 pb-2">
                Coach Occupancy Map (3AC)
            </h2>
            <div id="seat-map-view-container" class="mt-4 p-2 bg-slate-800 rounded-lg overflow-y-auto">
                <!-- Legend -->
                <div class="mb-4 flex justify-center space-x-4 text-sm font-medium border-b border-blue-500 pb-3">
                    <span class="flex items-center text-green-400"><span class="w-3 h-3 rounded-full bg-green-600 mr-2"></span> Occupied (Ours)</span>
                    <span class="flex items-center text-gray-400"><span class="w-3 h-3 rounded-full bg-gray-600 mr-2"></span> Not Ours</span>
                </div>
                
                <div id="seat-map-view" class="text-center text-gray-400">
                    <!-- Seat maps for all coaches rendered here -->
                </div>
            </div>
        </div>

        <!-- Passenger List Table (With overflow-x-auto for mobile scrolling) -->
        <div class="primary-card-bg p-6 rounded-xl shadow-2xl border border-blue-800 overflow-x-auto mt-6">
            <h2 class="text-2xl font-bold primary-text mb-4 border-b border-blue-700 pb-2">Passenger Details (All Coaches, Sorted by SR.NO)</h2>
            <table class="min-w-full divide-y divide-blue-700">
                <thead class="bg-blue-900/50">
                    <!-- Adjusted padding and text size for mobile table headers -->
                    <tr>
                        <th class="px-2 py-2 text-left text-xs sm:px-4 sm:py-3 font-medium text-gray-300 uppercase tracking-wider rounded-tl-lg">SR.NO</th>
                        <th class="px-2 py-2 text-left text-xs sm:px-4 sm:py-3 font-medium text-gray-300 uppercase tracking-wider">NAME</th>
                        <th class="px-2 py-2 text-left text-xs sm:px-4 sm:py-3 font-medium text-gray-300 uppercase tracking-wider">M/F</th>
                        <th class="px-2 py-2 text-left text-xs sm:px-4 sm:py-3 font-medium text-gray-300 uppercase tracking-wider">AGE</th>
                        <th class="px-2 py-2 text-left text-xs sm:px-4 sm:py-3 font-medium text-gray-300 uppercase tracking-wider">COACH</th>
                        <th class="px-2 py-2 text-left text-xs sm:px-4 sm:py-3 font-medium text-gray-300 uppercase tracking-wider">SEAT</th>
                        <th class="px-2 py-2 text-left text-xs sm:px-4 sm:py-3 font-medium text-gray-300 uppercase tracking-wider rounded-tr-lg">PNR</th>
                    </tr>
                </thead>
                <tbody id="passenger-table-body" class="divide-y divide-blue-800/50">
                    <!-- Data will be inserted by JavaScript, sorted by SR.NO -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Data provided by the user
        const rawData = [
            { sr: 1, name: "PUSHPA J", gender: "F", age: 70, coach: "B1", seat: 62, train: 20496, pnr: "8638623373" },
            { sr: 2, name: "GANPATRAJ", gender: "M", age: 65, coach: "B1", seat: 64, train: 20496, pnr: "8638623373" },
            { sr: 3, name: "PUSHPA GANPATRAJ", gender: "F", age: 60, coach: "B1", seat: 72, train: 20496, pnr: "8638623373" },
            { sr: 4, name: "DEEPAK", gender: "M", age: 48, coach: "B1", seat: 58, train: 20496, pnr: "8638623373" },
            { sr: 5, name: "URMILA", gender: "F", age: 50, coach: "B1", seat: 61, train: 20496, pnr: "8638623373" },
            { sr: 6, name: "PALAK", gender: "F", age: 24, coach: "B1", seat: 59, train: 20496, pnr: "8638623373" },
            { sr: 7, name: "KUMARPAL", gender: "M", age: 26, coach: "B1", seat: 25, train: 20496, pnr: "8138623513" },
            { sr: 8, name: "KAMAL", gender: "M", age: 45, coach: "B1", seat: 28, train: 20496, pnr: "8138623513" },
            { sr: 9, name: "PINKY", gender: "F", age: 43, coach: "B1", seat: 31, train: 20496, pnr: "8138623513" },
            { sr: 10, name: "KRIYA", gender: "F", age: 20, coach: "B1", seat: 26, train: 20496, pnr: "8138623513" },
            { sr: 11, name: "AANGI", gender: "F", age: 18, coach: "B1", seat: 29, train: 20496, pnr: "8138623513" },
            { sr: 12, name: "KAPIL", gender: "M", age: 38, coach: "B1", seat: 27, train: 20496, pnr: "8138623513" },
            { sr: 13, name: "SEEMA", gender: "F", age: 36, coach: "B2", seat: 50, train: 20496, pnr: "8538624604" },
            { sr: 14, name: "YANA", gender: "F", age: 15, coach: "B2", seat: 51, train: 20496, pnr: "8538624604" },
            { sr: 15, name: "RUHAN", gender: "M", age: 10, coach: "B2", seat: 67, train: 20496, pnr: "8538624604" },
            { sr: 16, name: "ARJUNJI", gender: "M", age: 8, coach: "B2", seat: 53, train: 20496, pnr: "8538624604" },
            { sr: 17, name: "TEENA", gender: "F", age: 36, coach: "B2", seat: 54, train: 20496, pnr: "8538624604" },
            { sr: 18, name: "VRITI", gender: "F", age: 17, coach: "B1", seat: 33, train: 20496, pnr: "8638623565" },
            { sr: 19, name: "AAGYA", gender: "F", age: 15, coach: "B1", seat: 34, train: 20496, pnr: "8638623565" },
            { sr: 20, name: "GULABCHAND", gender: "M", age: 60, coach: "B1", seat: 35, train: 20496, pnr: "8638623565" },
            { sr: 21, name: "MANJU", gender: "F", age: 60, coach: "B1", seat: 36, train: 20496, pnr: "8638623565" },
            { sr: 22, name: "JAINENDRA", gender: "M", age: 39, coach: "B1", seat: 37, train: 20496, pnr: "8638623565" },
            { sr: 23, name: "MONIKA", gender: "F", age: 37, coach: "B1", seat: 38, train: 20496, pnr: "8638623565" },
            { sr: 24, name: "MANISHA", gender: "F", age: 12, coach: "B2", seat: 56, train: 20496, pnr: "8538624604" },
            { sr: 25, name: "GOYAM", gender: "M", age: 7, coach: "B1", seat: 44, train: 20496, pnr: "8438623520" },
            { sr: 26, name: "SHIVAM", gender: "M", age: 30, coach: "B1", seat: 45, train: 20496, pnr: "8438623520" },
            { sr: 27, name: "SANTOSH", gender: "M", age: 42, coach: "B1", seat: 46, train: 20496, pnr: "8438623520" },
            { sr: 28, name: "RAJENDRA", gender: "M", age: 49, coach: "B1", seat: 7, train: 20496, pnr: "8819374101" },
            { sr: 29, name: "SANGITA", gender: "F", age: 49, coach: "B1", seat: 8, train: 20496, pnr: "8819374101" },
            { sr: 30, name: "RIDDHI", gender: "F", age: 26, coach: "B1", seat: 3, train: 20496, pnr: "8819374101" },
            { sr: 31, name: "YASHI", gender: "F", age: 23, coach: "B1", seat: 30, train: 20496, pnr: "8819374101" },
            { sr: 32, name: "DARSH", gender: "M", age: 17, coach: "B1", seat: 32, train: 20496, pnr: "8819374101" },
            { sr: 33, name: "DISHI", gender: "F", age: 17, coach: "B1", seat: 6, train: 20496, pnr: "8819374101" },
            { sr: 34, name: "SAJAN", gender: "F", age: 61, coach: "B2", seat: 25, train: 20496, pnr: "8926839204" },
            { sr: 35, name: "ANKUSH", gender: "M", age: 40, coach: "B2", seat: 26, train: 20496, pnr: "8926839204" },
            { sr: 36, name: "POOJA", gender: "F", age: 38, coach: "B2", seat: 27, train: 20496, pnr: "8926839204" },
            { sr: 37, name: "TATVA", gender: "M", age: 8, coach: "B2", seat: 28, train: 20496, pnr: "8926839204" },
            { sr: 38, name: "RAMESH", gender: "M", age: 62, coach: "B3", seat: 57, train: 20496, pnr: "8926841341" },
            { sr: 39, name: "VASANTI", gender: "F", age: 60, coach: "B3", seat: 60, train: 20496, pnr: "8926841341" },
            { sr: 40, name: "PISTABAI", gender: "F", age: 65, coach: "B3", seat: 65, train: 20496, pnr: "8238624692" },
            { sr: 41, name: "AMIT", gender: "M", age: 42, coach: "B2", seat: 29, train: 20496, pnr: "8926839204" },
            { sr: 42, name: "KOMAL", gender: "F", age: 40, coach: "B2", seat: 30, train: 20496, pnr: "8926839204" },
            { sr: 43, name: "LABDHI", gender: "F", age: 19, coach: "B1", seat: 41, train: 20496, pnr: "8438623520" },
            { sr: 44, name: "DHRITI", gender: "F", age: 17, coach: "B1", seat: 42, train: 20496, pnr: "8438623520" },
            { sr: 45, name: "MANAN", gender: "M", age: 13, coach: "B1", seat: 43, train: 20496, pnr: "8438623520" }
        ];

        // Custom colors for the dark theme
        const PRIMARY_COLOR = '#3b82f6'; // Bright Blue (for Male)
        const TERTIARY_COLOR = '#0ea5e9'; // Sky Blue (for Female)
        const BACKGROUND_COLOR = '#1e293b'; // Slate 800
        const UTILITY_COLOR = '#fcd34d'; // Amber (for Utilization)
        const SEAT_TALLY_COLOR = '#10b981'; // Emerald Green (for Seat Tally)


        /**
         * Core analysis function to calculate distributions and metrics.
         */
        function runAnalysis(data) {
            let maleCount = 0;
            let femaleCount = 0;
            const ageBins = { '1-15': 0, '15-30': 0, '30-40': 0, '40+': 0 };
            const uniqueCoaches = new Set();

            data.forEach(p => {
                // Gender
                if (p.gender === 'M') maleCount++;
                else if (p.gender === 'F') femaleCount++;

                // Age Distribution
                if (p.age >= 1 && p.age < 15) ageBins['1-15']++;
                else if (p.age >= 15 && p.age < 30) ageBins['15-30']++;
                else if (p.age >= 30 && p.age < 40) ageBins['30-40']++;
                else if (p.age >= 40) ageBins['40+']++;
                
                // Coaches for filter generation
                uniqueCoaches.add(p.coach);
            });

            return {
                totalPassengers: data.length,
                maleCount, 
                femaleCount,
                genderData: [maleCount, femaleCount],
                ageBins: Object.values(ageBins),
                coachList: Array.from(uniqueCoaches).sort()
            };
        }

        /**
         * Renders the key metrics onto the dashboard.
         */
        function renderMetrics(analysis) {
            document.getElementById('total-passengers').textContent = analysis.totalPassengers;
            document.getElementById('total-males').textContent = analysis.maleCount;
            document.getElementById('total-females').textContent = analysis.femaleCount;
        }

        /**
         * Helper to determine seat type based on seat number in a 3AC coach (8 seats per bay).
         * This logic is based on the user's specific request: 1-6 are main berths, 7-8 are side berths.
         * * Seat numbering mapping (Mod 8 cycle):
         * 1 (LB), 2 (MB), 3 (UB) -> Main Compartment (first set)
         * 4 (LB), 5 (MB), 6 (UB) -> Main Compartment (second set)
         * 7 (SL) -> Side Lower
         * 8 (SU) -> Side Upper
         */
        function getSeatInfo(seat) {
            // Get the position within the 8-seat cycle (1 to 8)
            // If seat % 8 is 0, it means the seat is the 8th seat in the bay (e.g., 8, 16, 24, etc.)
            const pos = seat % 8 === 0 ? 8 : seat % 8; 

            if (pos === 1 || pos === 4) {
                // Seats 1 and 4 are Lower Berths. Both map to column 1 in visualization.
                return { type: 'LB', name: 'Lower Berth', col: 1 };
            } else if (pos === 2 || pos === 5) {
                // Seats 2 and 5 are Middle Berths. Both map to column 2 in visualization.
                return { type: 'MB', name: 'Middle Berth', col: 2 };
            } else if (pos === 3 || pos === 6) {
                // Seats 3 and 6 are Upper Berths. Both map to column 3 in visualization.
                return { type: 'UB', name: 'Upper Berth', col: 3 };
            } else if (pos === 7) {
                // Seat 7 is Side Lower. Maps to column 5 (skipping passage).
                return { type: 'SL', name: 'Side Lower', col: 5 };
            } else if (pos === 8) {
                // Seat 8 is Side Upper. Maps to column 6.
                return { type: 'SU', name: 'Side Upper', col: 6 };
            }
            return { type: 'ERR', name: 'Error', col: 1 }; 
        }

        /**
         * Calculates coach utilization (by count) and seat type berth tallies (by count).
         */
        function calculateUtilizationAnalysis(data) {
            const analysis = {
                coachUtilization: [],
                seatTypeTally: { LB: 0, MB: 0, UB: 0, SL: 0, SU: 0 }
            };

            // 1. Calculate Coach Utilization by COUNT
            const coachCounts = data.reduce((acc, p) => {
                acc[p.coach] = (acc[p.coach] || 0) + 1;
                return acc;
            }, {});

            // Sort coaches (B1, B2, B3) for consistent chart output
            const sortedCoaches = Object.keys(coachCounts).sort();

            sortedCoaches.forEach(coach => {
                const occupied = coachCounts[coach];
                
                // Now storing the count directly, not the percentage
                analysis.coachUtilization.push({
                    coach: coach,
                    count: occupied 
                });
            });
            
            // 2. Calculate Seat Type Tally (by COUNT)
            data.forEach(p => {
                const seatInfo = getSeatInfo(p.seat);
                if (analysis.seatTypeTally.hasOwnProperty(seatInfo.type)) {
                    analysis.seatTypeTally[seatInfo.type]++;
                }
            });

            return analysis;
        }

        /**
         * Renders the Utilization Analysis as charts.
         */
        function renderUtilizationCharts(analysis) {
            Chart.defaults.color = '#e2e8f0'; 
            
            const chartOptions = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { 
                    legend: { display: false }, 
                    tooltip: { backgroundColor: '#1f2937', bodyColor: '#ffffff' } 
                },
                scales: {
                    x: { grid: { color: 'rgba(55, 65, 81, 0.5)' }, ticks: { color: '#94a3b8' } },
                    y: { beginAtZero: true, grid: { color: 'rgba(55, 65, 81, 0.5)' }, ticks: { color: '#94a3b8', precision: 0 } }
                }
            };

            // --- COACH UTILIZATION CHART (Horizontal Bar, now by COUNT) ---
            const coachLabels = analysis.coachUtilization.map(c => c.coach);
            const coachData = analysis.coachUtilization.map(c => c.count); // Using count here

            new Chart(document.getElementById('coachUtilizationChart'), {
                type: 'bar',
                data: {
                    labels: coachLabels,
                    datasets: [{
                        label: 'Seats Occupied (Count)',
                        data: coachData,
                        backgroundColor: UTILITY_COLOR, 
                        borderColor: BACKGROUND_COLOR,
                        borderWidth: 1,
                        borderRadius: 4,
                    }]
                },
                options: {
                    ...chartOptions,
                    indexAxis: 'y', // Make it a horizontal bar chart
                    scales: {
                         x: { 
                            ...chartOptions.scales.x,
                            // Removed max: 100 as it's no longer percentage
                            title: { display: true, text: 'Seats Occupied (Count)', color: '#94a3b8' },
                         },
                         y: chartOptions.scales.y
                    }
                }
            });


            // --- SEAT TYPE TALLY CHART (Vertical Bar) ---
            // Updated labels to reflect the L/M/U/L/M/U, SL/SU pattern
            const berthLabels = ['Lower Berth (LB)', 'Middle Berth (MB)', 'Upper Berth (UB)', 'Side Lower (SL)', 'Side Upper (SU)'];
            
            // We need to count LB, MB, UB, SL, SU for the visualization
            // Since LB, MB, UB are repeated in the 1-6 sequence, they are tallied together
            const berthCounts = ['LB', 'MB', 'UB', 'SL', 'SU'].map(type => analysis.seatTypeTally[type]);
            
            new Chart(document.getElementById('seatTypeTallyChart'), {
                type: 'bar',
                data: {
                    labels: berthLabels,
                    datasets: [{
                        label: 'Passenger Count',
                        data: berthCounts,
                        backgroundColor: SEAT_TALLY_COLOR,
                        borderColor: BACKGROUND_COLOR,
                        borderWidth: 1,
                        borderRadius: 4,
                    }]
                },
                options: {
                    ...chartOptions,
                    scales: {
                         x: { 
                            ...chartOptions.scales.x,
                            ticks: { autoSkip: false, maxRotation: 45, minRotation: 45 } 
                         },
                         y: chartOptions.scales.y
                    },
                    tooltips: {
                        callbacks: {
                            label: function(tooltipItem, data) {
                                return data.datasets[tooltipItem.datasetIndex].label + ': ' + tooltipItem.raw;
                            }
                        }
                    }
                }
            });
        }


        /**
         * Renders the interactive seat map for ALL coaches.
         */
        function renderAllSeatMaps(data) {
            const seatMapContainer = document.getElementById('seat-map-view');
            seatMapContainer.innerHTML = '';
            
            // Get unique coaches and sort them (B1, B2, B3)
            const uniqueCoaches = Array.from(new Set(data.map(p => p.coach))).sort();
            
            if (uniqueCoaches.length === 0) {
                seatMapContainer.innerHTML = '<p class="text-gray-400 p-4 text-center">No coach data found.</p>';
                return;
            }

            uniqueCoaches.forEach(coach => {
                const coachData = data.filter(p => p.coach === coach);
                const occupiedSeats = new Set(coachData.map(p => p.seat));
                const passengerMap = new Map(coachData.map(p => [p.seat, p]));

                // Create a container for the individual coach map - using smaller styles
                const coachMapDiv = document.createElement('div');
                coachMapDiv.className = 'coach-map-container border border-blue-600 rounded-lg bg-slate-700/50';
                coachMapDiv.innerHTML = `<h3 class="text-lg font-bold text-yellow-300 mb-3 border-b border-blue-500 pb-1 text-center">Coach ${coach}</h3>`;

                const coachMapGrid = document.createElement('div');
                coachMapGrid.className = 'space-y-1'; // Reduced spacing
                
                const totalSeats = 72; 
                const bays = [];

                // Group seats by bay (8 seats per bay)
                for(let i=1; i<= totalSeats; i++) {
                    const bayIndex = Math.floor((i - 1) / 8);
                    if (!bays[bayIndex]) bays[bayIndex] = [];
                    bays[bayIndex].push(i);
                }

                let coachHasOccupiedBay = false;

                bays.forEach((bay, index) => {
                    // Check if ANY seat in this bay is occupied by one of our passengers
                    const bayHasOccupiedSeat = bay.some(seatNumber => occupiedSeats.has(seatNumber));
                    
                    // Only render bays that have at least one occupied seat
                    if (!bayHasOccupiedSeat) {
                        return; 
                    }
                    
                    coachHasOccupiedBay = true; 

                    const bayDiv = document.createElement('div');
                    bayDiv.className = 'seat-bay-row';
                    // Display bay range (e.g., 1-8, 9-16)
                    const startSeat = bay[0];
                    const endSeat = bay[bay.length - 1];
                    bayDiv.innerHTML = `<div class="seat-bay-label">Bay ${index + 1} (${startSeat}-${endSeat})</div>`;
                    
                    bay.forEach(seatNumber => {
                        const isOccupied = occupiedSeats.has(seatNumber);
                        const passenger = passengerMap.get(seatNumber);
                        const seatInfo = getSeatInfo(seatNumber); // Uses the updated logic

                        let tooltipText;
                        let elementContent;

                        if (isOccupied) {
                            // Get the first word of the name
                            let displayableName = passenger.name.split(' ')[0];
                            
                            // Truncate long names to prevent overflow (e.g., GULABCHAND)
                            if (displayableName.length > 7) {
                                displayableName = displayableName.substring(0, 5) + '..'; 
                            }

                            // Using innerHTML to format the seat number smaller than the name
                            elementContent = `<span class="text-xs font-normal">${seatNumber}</span><br/>${displayableName}`;
                            // Tooltip shows full name, age, seat number and type
                            tooltipText = `${passenger.name} (${passenger.age}) - Seat ${seatNumber} (${seatInfo.name})`;
                        } else {
                            // Non-occupied seats show Seat Number and Type
                            elementContent = `${seatNumber} (${seatInfo.type})`; 
                            tooltipText = `Seat ${seatNumber} (${seatInfo.name})`; 
                        }

                        let seatElement = document.createElement('div');
                        seatElement.className = `seat-element font-bold ${isOccupied ? 'seat-occupied' : 'seat-available'}`;
                        
                        // Use innerHTML to inject the multi-line content
                        seatElement.innerHTML = elementContent; 
                        
                        seatElement.title = tooltipText;
                        
                        // Set the grid column based on the column defined in getSeatInfo
                        seatElement.style.gridColumn = seatInfo.col;

                        bayDiv.appendChild(seatElement);
                    });
                    coachMapGrid.appendChild(bayDiv);
                });
                
                if (coachHasOccupiedBay) {
                    coachMapDiv.appendChild(coachMapGrid);
                    seatMapContainer.appendChild(coachMapDiv);
                }
            });
            
            if (seatMapContainer.innerHTML === '') {
                 seatMapContainer.innerHTML = '<p class="text-gray-400 p-4 text-center">No occupied seats were found in any coach.</p>';
            }
        }


        /**
         * Renders the passenger data table (always shows all data, sorted by SR.NO).
         */
        function renderTable(data) {
            const tbody = document.getElementById('passenger-table-body');
            tbody.innerHTML = ''; // Clear existing data
            
            const filteredData = data; 
            
            if (filteredData.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="7" class="px-4 py-8 text-center text-gray-400 bg-slate-700/50">No passenger data found.</td>`;
                tbody.appendChild(row);
                return;
            }

            // 1. Sort by SR.NO (Serial Number)
            filteredData.sort((a, b) => a.sr - b.sr);
            
            // 2. Iterate through sorted passengers and render rows individually
            filteredData.forEach(p => {
                const row = document.createElement('tr');
                const rowClass = 'bg-slate-700 hover:bg-blue-900/70 transition duration-150 border-b border-blue-800/50';
                row.className = rowClass;

                // Construct the passenger data row (PNR is in its own cell for every row)
                // Use responsive classes (px-2, text-xs) for mobile optimization
                row.innerHTML = `
                    <td class="px-2 py-2 sm:px-4 sm:py-3 whitespace-nowrap text-xs sm:text-sm font-medium primary-text">${p.sr}</td>
                    <td class="px-2 py-2 sm:px-4 sm:py-3 whitespace-nowrap text-xs sm:text-sm text-gray-200">${p.name}</td>
                    <td class="px-2 py-2 sm:px-4 sm:py-3 whitespace-nowrap text-xs sm:text-sm text-gray-200">${p.gender}</td>
                    <td class="px-2 py-2 sm:px-4 sm:py-3 whitespace-nowrap text-xs sm:text-sm text-gray-200">${p.age}</td>
                    <td class="px-2 py-2 sm:px-4 sm:py-3 whitespace-nowrap text-xs sm:text-sm text-yellow-400 font-semibold">${p.coach}</td>
                    <td class="px-2 py-2 sm:px-4 sm:py-3 whitespace-nowrap text-xs sm:text-sm text-gray-200">${p.seat}</td>
                    <td class="px-2 py-2 sm:px-4 sm:py-3 whitespace-nowrap text-xs sm:text-sm font-bold text-orange-400">${p.pnr}</td>
                `;
                
                tbody.appendChild(row);
            });
        }

        /**
         * Sets up the Chart.js configuration for the main demographic charts.
         */
        function setupMainCharts(analysis) {
            Chart.defaults.color = '#e2e8f0'; 
            Chart.defaults.font.family = 'Inter, sans-serif';

            // --- Age Distribution Chart (Bar Chart) ---
            new Chart(document.getElementById('ageDistributionChart'), {
                type: 'bar',
                data: {
                    labels: ['1-15 Years (Children)', '15-30 Years (Youth)', '30-40 Years (Young Adults)', '40+ Years (Seniors)'],
                    datasets: [{
                        label: 'Number of Passengers',
                        data: analysis.ageBins,
                        backgroundColor: [
                            '#3b82f6', // Bright Blue
                            '#0ea5e9', // Sky Blue
                            '#6366f1', // Indigo
                            '#f97316'  // Orange for Seniors
                        ],
                        borderColor: BACKGROUND_COLOR,
                        borderWidth: 2,
                        borderRadius: 6,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false }, title: { display: false }, tooltip: { backgroundColor: '#1f2937', bodyColor: '#ffffff' } },
                    scales: {
                        x: { grid: { color: 'rgba(55, 65, 81, 0.5)' }, ticks: { color: '#94a3b8' } },
                        y: { beginAtZero: true, grid: { color: 'rgba(55, 65, 81, 0.5)' }, ticks: { color: '#94a3b8', precision: 0 } }
                    }
                }
            });

            // --- Gender Distribution Chart (Doughnut Chart) ---
            new Chart(document.getElementById('genderDistributionChart'), {
                type: 'doughnut',
                data: {
                    labels: ['Male', 'Female'],
                    datasets: [{
                        label: 'Gender Count',
                        data: analysis.genderData,
                        backgroundColor: [
                            PRIMARY_COLOR, // Male
                            TERTIARY_COLOR  // Female
                        ],
                        hoverOffset: 8,
                        borderWidth: 2,
                        borderColor: BACKGROUND_COLOR
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    cutout: '70%',
                    plugins: {
                        legend: { position: 'bottom', labels: { padding: 20 } },
                        tooltip: { backgroundColor: '#1f2937', bodyColor: '#ffffff' }
                    }
                }
            });
        }
        
        /**
         * Initializes the dashboard components.
         */
        function initialRenderSetup(analysis) {
            // Calculate Utilization Analysis (now by count)
            const utilizationAnalysis = calculateUtilizationAnalysis(rawData);
            
            // Render the updated Utilization Charts
            renderUtilizationCharts(utilizationAnalysis);

            // Render the table 
            renderTable(rawData);
            
            // Render all seat maps (now smaller)
            renderAllSeatMaps(rawData); 
        }

        // Initialize the dashboard
        window.onload = function() {
            const analysis = runAnalysis(rawData);
            renderMetrics(analysis);
            setupMainCharts(analysis);
            initialRenderSetup(analysis); 
        };
    </script>
 <footer class="text-center text-gray-400 mt-10 pb-6 text-sm tracking-wide">
    Visualization Created and Executed by <span class="font-semibold text-blue-400">Darsh Rajendra Jain</span>
 </footer>



</body>
</html>
